<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ITSM_ISSUE">

<select id="selectProcessDetail" parameterType="String" resultType="HashMap">
	SELECT SR_ID
		, PROC_ID
		, UP_SR_ID
		, FC_GET_CODE_NM('REQ_TYPE', REQ_TYPE) AS REQ_TYPE_NM
		, REQ_TYPE
		, TITLE
		, STATIS_CHECK
		,(SELECT SERVICE_TYPE FROM PROC_SERVICE WHERE SR_ID = A.SR_ID) AS SERVICE_TYPE
		, FC_GET_CODE_NM('SVR_REQ_TYPE', (SELECT SERVICE_TYPE FROM PROC_SERVICE WHERE SR_ID = A.SR_ID)) AS SERVICE_TYPE_NM
		, FC_GET_CODE_NM('SERVICE_STATE', WORK_STATE) AS WORK_STATE_NM
		, FC_GET_CODE_NM('REQ_PATH', REQ_PATH) AS REQ_PATH_NM
		, FC_GET_CODE_NM('HAPPYCALL_YN', HAPPYCALL_YN) AS HAPPYCALL_YN_NM
		, FC_GET_CODE_NM('FIRST_YN', FIRST_YN) AS FIRST_YN_NM
		, FC_GET_CODE_NM('STATIS_CHECK', STATIS_CHECK) AS STATIS_CHECK_NM
		, FC_GET_CODE_NM('STATIS_RESULT', STATIS_RESULT) AS STATIS_RESULT_NM
		, FC_GET_CODE_NM('STATIS_END_TYPE', STATIS_END_TYPE) AS STATIS_END_TYPE_NM
		, FC_GET_CODE_NM('SPEED_RESULT', SPEED_RESULT) AS SPEED_RESULT_NM
		, FC_GET_CODE_NM('ACCURACY_RESULT', ACCURACY_RESULT) AS ACCURACY_RESULT_NM
		, HAPPYCALL_YN
		, FIRST_YN
		, STATIS_RESULT
		, SPEED_RESULT
		, ACCURACY_RESULT
		, STATIS_END_TYPE
		, STATIS_CONTENT
		, REQ_ZONE
		, REQ_PATH
		, WORK_STATE
		, REQ_USER_ID
		, REL_INC_SR_ID
		, FC_GET_USER_NM(REQ_USER_ID) AS REQ_USER_NM
		, CONTENT
		, TO_CHAR(WORK_DT,'YYYY-MM-DD HH24:MI') AS WORK_DT
		, TO_CHAR(WORK_DT,'YYYY-MM-DD') AS WORK_DT_DAY
		, TO_CHAR(WORK_DT,'HH24') AS WORK_DT_HOUR
		, TO_CHAR(WORK_DT,'MI') AS WORK_DT_MIN
		, TO_CHAR(REC_DT,'YYYY-MM-DD HH24:MI') AS REC_DT
		, TO_CHAR(REC_DT,'YYYY-MM-DD') AS REC_DT_DAY
		, TO_CHAR(REC_DT,'HH24') AS REC_DT_HOUR
		, TO_CHAR(REC_DT,'MI') AS REC_DT_MIN
		, TO_CHAR(REQ_DT,'YYYY-MM-DD HH24:MI') AS REQ_DT
		, TO_CHAR(REQ_DT,'YYYY-MM-DD') AS REQ_DT_DAY
		, TO_CHAR(REQ_DT,'HH24') AS REQ_DT_HOUR
		, TO_CHAR(REQ_DT,'MI') AS REQ_DT_MIN
		, TO_CHAR(HOPE_DT,'YYYY-MM-DD HH24:MI') AS HOPE_DT
		, TO_CHAR(HOPE_DT,'YYYY-MM-DD') AS HOPE_DT_DAY
		, TO_CHAR(HOPE_DT,'HH24') AS HOPE_DT_HOUR
		, TO_CHAR(HOPE_DT,'MI') AS HOPE_DT_MIN
		, TO_CHAR(DUE_DT,'YYYY-MM-DD HH24:MI') AS DUE_DT
		, TO_CHAR(DUE_DT,'YYYY-MM-DD') AS DUE_DT_DAY
		, TO_CHAR(DUE_DT,'HH24') AS DUE_DT_HOUR
		, TO_CHAR(DUE_DT,'MI') AS DUE_DT_MIN
		, TO_CHAR(REC_DT,'YYYY-MM-DD HH24:MI') AS REC_DT
		, TO_CHAR(STATIS_END_DT,'YYYY-MM-DD HH24:MI') AS STATIS_END_DT
		, TO_CHAR(STATIS_END_DT,'YYYY-MM-DD') AS STATIS_END_DT_DAY
		, TO_CHAR(STATIS_END_DT,'HH24') AS STATIS_END_DT_HOUR
		, TO_CHAR(STATIS_END_DT,'MI') AS STATIS_END_DT_MIN
		, ATCH_FILE_ID
	FROM PROC_MASTER A
		WHERE A.SR_ID = #{value, jdbcType=VARCHAR}
</select>

<select id="selectPROC_SERVICE" parameterType="String" resultType="HashMap">
	SELECT SR_ID 
		, SERVICE_TYPE
		, FC_GET_CODE_NM('SERVICE_TYPE', SERVICE_TYPE) AS SERVICE_TYPE_NM 
		, APPROVAL_YN
		, FC_GET_CODE_NM('APPROVAL_YN', APPROVAL_YN) AS APPROVAL_YN_NM 
		, WORK_RESULT 
		, CHANGE_SR_ID 
		, INCIDENT_SR_ID 
		, TO_CHAR(RESULT_HOPE_DT, 'YYYY-MM-DDHH24MI') AS RESULT_HOPE_DT 
		, TO_CHAR(RESULT_HOPE_DT, 'YYYY-MM-DD') AS RESULT_HOPE_DT_DAY 
		, TO_CHAR(RESULT_HOPE_DT, 'HH24') AS RESULT_HOPE_DT_HOUR 
		, TO_CHAR(RESULT_HOPE_DT, 'MI') AS RESULT_HOPE_DT_MIN 
		, RESULT_SERVICE_TYPE
		, FC_GET_CODE_NM('RESULT_SERVICE_TYPE', RESULT_SERVICE_TYPE) AS RESULT_SERVICE_TYPE_NM 
		, KEDB_ID 
		, SYSTEM_TYPE
		, (SELECT CONF_NM FROM AM_INFRA WHERE CONF_ID = SYSTEM_TYPE) AS SYSTEM_TYPE_NM 
		, SUB_WORK
		, (SELECT SERVICE_NM FROM AM_SERVICE WHERE SERVICE_ID = SUB_WORK) AS SUB_WORK_NM 
		, UPD_USER_ID 
		, TO_CHAR(UPD_DT, 'YYYY-MM-DDHH24MI') AS UPD_DT 
		, TO_CHAR(UPD_DT, 'YYYY-MM-DD') AS UPD_DT_DAY 
		, TO_CHAR(UPD_DT, 'HH24') AS UPD_DT_HOUR 
		, TO_CHAR(UPD_DT, 'MI') AS UPD_DT_MIN 
	FROM PROC_SERVICE 
	WHERE SR_ID = #{value, jdbcType=VARCHAR}
</select>

<select id="searchTaskCommentList" parameterType="String" resultType="HashMap">
	SELECT
		FC_GET_USER_NM(B.ACTUALOWNER_ID) AS WORK_USER_NM
		, B.ACTUALOWNER_ID AS WORK_USER
		, C.NODENAME
		, TO_CHAR(B.COMPLETEDON, 'YYYY-MM-DD HH24:MI:SS') AS WORK_DATE
		, B.COMMENT_TEXT TEXT
		, C.TASK_NAME
	FROM PROC_MASTER A
		, PROC_DETAIL B
		, NBPM_NODE_DETAIL C
	WHERE A.SR_ID      = B.SR_ID
		AND B.WORK_STATE = C.TASK_NAME
		AND C.PROCESSID  = 'SERVICE_v_1'
		AND A.SR_ID = #{value, jdbcType=VARCHAR}
	ORDER BY B.SEQ ASC
</select>


</mapper>